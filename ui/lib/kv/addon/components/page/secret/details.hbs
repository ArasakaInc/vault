<KvPageHeader @breadcrumbs={{@breadcrumbs}} @pageTitle={{@path}}>
  <:tabLinks>
    <LinkTo @route="secret.details" data-test-secrets-tab="Secret">Secret</LinkTo>
    <LinkTo @route="secret.metadata.index" data-test-secrets-tab="Metadata">Metadata</LinkTo>
    {{#if @secret.canReadMetadata}}
      <LinkTo @route="secret.metadata.versions" data-test-secrets-tab="Version History">Version History</LinkTo>
      {{#if (gt @metadata.sortedVersions.length 1)}}
        <LinkTo @route="secret.metadata.diff" data-test-secrets-tab="Version Diff">Version Diff</LinkTo>
      {{/if}}
    {{/if}}
  </:tabLinks>

  <:toolbarFilters>
    {{#unless this.emptyState}}
      <Toggle @name="json" @status="success" @size="small" @checked={{this.showJsonView}} @onChange={{this.toggleJsonView}}>
        <span class="has-text-grey">JSON</span>
      </Toggle>
    {{/unless}}
  </:toolbarFilters>
  <:toolbarActions>
    {{! Start of delete options }}
    {{#if (and @secret.deletionTime @secret.canUndelete (not @secret.destroyed))}}
      <button
        type="button"
        class="toolbar-link"
        {{on "click" (fn this.handleDelete "undelete")}}
        data-test-kv-delete="undelete-version"
      >
        Undelete
      </button>
    {{/if}}
    {{#if
      (and (not @secret.deletionTime) (not @secret.destroyed) (or @secret.canDeleteVersion @secret.canDeleteLatestVersion))
    }}
      <KvDeleteModal
        @mode="delete"
        @toggleModal={{(fn this.toggleModal "delete")}}
        @modalOpen={{this.deleteModalOpen}}
        @handleDelete={{(fn this.handleDelete "delete")}}
        @buttonText="Delete"
        @disabled={{(not this.deleteType)}}
      >
        <:description>
          There are two ways to delete a version of a secret. Both delete actions can be undeleted later. How would you like
          to proceed?
        </:description>
        <:content>
          <div class="is-flex-column">
            {{#each this.generateDeleteRadioOptions as |option|}}
              <ToolTip @verticalPosition="above" @horizontalPosition="left" as |T|>
                <T.Trigger @tabindex="-1">
                  <div class="is-flex-align-baseline has-bottom-margin-m">
                    <RadioButton
                      id={{dasherize option.label}}
                      class="radio top-xxs"
                      @disabled={{option.disabled}}
                      @value={{option.key}}
                      @groupValue={{this.deleteType}}
                      @onChange={{fn (mut this.deleteType) option.key}}
                    />
                    <div class="has-left-margin-s {{if option.disabled 'text-disabled'}}">
                      <label class="has-text-weight-semibold">{{option.label}}</label>
                      <p>{{option.description}}</p>
                    </div>
                  </div>
                </T.Trigger>
                {{#if option.disabled}}
                  <T.Content @defaultClass="tool-tip">
                    <div class="box">
                      {{option.tooltipMessage}}
                    </div>
                  </T.Content>
                {{/if}}
              </ToolTip>
            {{/each}}
          </div>
        </:content>
      </KvDeleteModal>
    {{/if}}
    {{#if (and (not @secret.destroyed) @secret.canDestroyVersion)}}
      <KvDeleteModal
        @mode="destroy-version"
        @toggleModal={{(fn this.toggleModal "destroy")}}
        @modalOpen={{this.destroyModalOpen}}
        @handleDelete={{(fn this.handleDelete "destroy")}}
        @buttonText="Destroy"
      >
        <:description>
          This action will permanently destroy Version
          {{@secret.version}}
          of the secret, and the secret data cannot be read or recovered later.
        </:description>
      </KvDeleteModal>
    {{/if}}
    {{! End of delete options }}
    {{#if @secret.canReadMetadata}}
      <KvVersionDropdown @secret={{@secret}} @metadata={{@metadata}} @onClose={{this.onClose}} />
    {{/if}}
    {{#if @secret.canEditData}}
      <ToolbarLink data-test-create-new-version @route="secret.details.edit" @type="add">Create new version</ToolbarLink>
    {{/if}}
  </:toolbarActions>
</KvPageHeader>

{{#if this.emptyState}}
  <EmptyState @title={{this.emptyState.title}} @message={{this.emptyState.message}}>
    {{#if this.emptyState.link}}
      <DocLink @path={{this.emptyState.link}}>Learn more</DocLink>
    {{/if}}
  </EmptyState>
{{else}}
  <div class="info-table-row-header">
    <div class="info-table-row thead {{if this.showJsonView 'is-shadowless'}} ">
      {{#unless this.showJsonView}}
        <div class="th column is-one-quarter">
          Key
        </div>
        <div class="th column">
          Value
        </div>
      {{/unless}}
      <div class="th column justify-right" data-test-created-time>
        <ToolTip @verticalPosition="below" @horizontalPosition="right" as |T|>
          <T.Trigger data-test-kv-version-tooltip-trigger tabindex="-1">
            Version
            {{if @secret.version @secret.version}}
            created
            {{date-format @secret.createdTime "MMM dd, yyyy hh:mm a"}}
          </T.Trigger>
          <T.Content @defaultClass="tool-tip smaller-font">
            <div class="box" data-test-hover-copy-tooltip-text>
              {{@secret.createdTime}}
            </div>
          </T.Content>
        </ToolTip>
      </div>
    </div>
  </div>

  {{#if this.showJsonView}}
    <JsonEditor @title="Version data" @value={{stringify @secret.secretData}} @readOnly={{true}} />
  {{else}}
    {{#each-in @secret.secretData as |key value|}}
      <InfoTableRow @label={{key}} @value={{value}} @alwaysRender={{true}}>
        <MaskedInput @name={{key}} @value={{value}} @displayOnly={{true}} @allowCopy={{true}} @allowDownload={{true}} />
      </InfoTableRow>
    {{else}}
      <InfoTableRow @label="" @value="" @alwaysRender={{true}} />
    {{/each-in}}
  {{/if}}
{{/if}}